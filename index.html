<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Basket Tournament Scheduler</title>

    <style>
        :root {
            --blue1: #2563eb;
            --blue2: #1e40af;
            --glass: rgba(255, 255, 255, .75);
            --border: rgba(255, 255, 255, .35);
            --bg1: #0f172a;
            --bg2: #020617;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: "Inter", Segoe UI, Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg1), var(--bg2));
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: auto;
        }

        /* HEADER */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: white;
        }

        /* CARD */
        .card {
            background: var(--glass);
            backdrop-filter: blur(14px);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 22px;
            margin-bottom: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .25);
        }

        /* HIDDEN STATE */
        .hidden {
            display: none;
        }

        .fade-in {
            animation: fade .6s ease forwards;
        }

        @keyframes fade {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* INPUT */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
        }

        .field label {
            font-size: 13px;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 11px;
            border-radius: 12px;
            border: none;
        }

        button {
            margin-top: 20px;
            padding: 14px;
            width: 100%;
            border: none;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--blue1), var(--blue2));
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        /* GROUPS */
        .group-title {
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--blue2);
        }

        .team {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 999px;
            background: #e0e7ff;
            color: #1e3a8a;
            font-size: 13px;
            margin: 4px;
        }

        /* TABLE */
        .day-title {
            font-weight: 800;
            margin: 30px 0 10px;
            color: var(--blue2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 14px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, var(--blue1), var(--blue2));
            color: white;
            padding: 12px;
        }

        td {
            padding: 12px;
            background: white;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .stat-item {
            background: white;
            padding: 14px;
            border-radius: 14px;
            margin-bottom: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, .08);
        }

        .stat-title {
            font-size: 13px;
            opacity: .7;
        }

        .stat-value {
            font-size: 26px;
            font-weight: 800;
            color: var(--blue2);
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="header">
            <h1>üèÄ Basket Tournament Scheduler</h1>
            <span>Greedy Fair-Rest Algorithm</span>
        </div>

        <!-- INPUT -->
        <div class="card">
            <h3>‚öôÔ∏è Pengaturan Turnamen</h3>
            <div class="grid">
                <input id="groups" type="number" value="3" placeholder="Jumlah Grup">
                <input id="teams" type="number" value="4" placeholder="Tim per Grup">
                <input id="startHour" type="time" value="08:00" placeholder="Jam Mulai">
                <input id="endHour" type="time" value="17:00" placeholder="Jam Selesai">
                <input id="duration" type="number" value="60" placeholder="Durasi (menit)">
            </div>
            <button onclick="generate()">üöÄ Buat Jadwal</button>
        </div>

        <!-- GROUP & STATS WRAPPER -->
        <div style="display:grid;grid-template-columns:2fr 1fr;gap:20px">

            <!-- GROUP LIST -->
            <div id="groupCard" class="card hidden">
                <h3>üë• Daftar Grup & Tim</h3>
                <div id="groupsList"></div>
            </div>

            <!-- STATS -->
            <div id="statsCard" class="card hidden">
                <h3>üìä Statistik Turnamen</h3>
                <div id="stats"></div>
            </div>

        </div>

        <!-- SCHEDULE -->
        <div id="scheduleCard" class="card hidden">
            <h3>üìÖ Jadwal Pertandingan</h3>
            <div id="schedule"></div>
        </div>

    </div>

    <script>
        function timeToMinutes(timeStr) {
            const [h, m] = timeStr.split(":").map(Number);
            return h * 60 + m;
        }

        function minutesToTime(min) {
            const h = Math.floor(min / 60);
            const m = min % 60;
            return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
        }

        function generate() {
            const statsCard = document.getElementById("statsCard");
            const statsDiv = document.getElementById("stats");
            statsCard.classList.remove("hidden");
            statsCard.classList.add("fade-in");

            const groupsInput = document.getElementById("groups");
            const teamsInput = document.getElementById("teams");
            const startInput = document.getElementById("startHour");
            const endInput = document.getElementById("endHour");
            const durationInput = document.getElementById("duration");

            const groupsList = document.getElementById("groupsList");
            const schedule = document.getElementById("schedule");
            const groupCard = document.getElementById("groupCard");
            const scheduleCard = document.getElementById("scheduleCard");

            groupCard.classList.remove("hidden");
            scheduleCard.classList.remove("hidden");
            groupCard.classList.add("fade-in");
            scheduleCard.classList.add("fade-in");

            const gC = +groupsInput.value;
            const tC = +teamsInput.value;
            const start = timeToMinutes(startInput.value);
            const end = timeToMinutes(endInput.value);
            const dur = +durationInput.value;

            groupsList.innerHTML = "";
            schedule.innerHTML = "";

            // Struktur data baru yang lebih lengkap
            let groups = {};
            let matches = [];
            let lastMatchTime = {}; // waktu absolut terakhir bermain
            let matchCountToday = {}; // jumlah match hari ini per tim
            let matchCountTotal = {}; // total match yang sudah dimainkan per tim

            // Inisialisasi data tim
            for (let g = 0; g < gC; g++) {
                const name = String.fromCharCode(65 + g);
                groups[name] = [];
                for (let t = 1; t <= tC; t++) {
                    const team = `G${name}-T${t}`;
                    groups[name].push(team);
                    lastMatchTime[team] = -9999;
                    matchCountToday[team] = 0;
                    matchCountTotal[team] = 0;
                }
            }

            // Buat semua match
            for (let g in groups) {
                const div = document.createElement("div");
                div.innerHTML = `<div class="group-title">Grup ${g}</div>`;
                groups[g].forEach(t => div.innerHTML += `<span class="team">${t}</span>`);
                groupsList.appendChild(div);

                for (let i = 0; i < groups[g].length; i++) {
                    for (let j = i + 1; j < groups[g].length; j++) {
                        matches.push({
                            g,
                            a: groups[g][i],
                            b: groups[g][j],
                            weight: 0
                        });
                    }
                }
            }

            let day = 1;
            let time = start;
            let table = createTable(day);
            let matchesPerDay = {};
            matchesPerDay[day] = 0;

            let lastGroup = null;
            let groupMatchCountPerDay = {};
            groupMatchCountPerDay[day] = {};

            // Reset matchCountToday untuk hari pertama
            for (let team in matchCountToday) {
                matchCountToday[team] = 0;
            }

            // Konstanta untuk algoritma
            const MIN_REST = dur; // Istirahat minimal = durasi match
            const DAY_PENALTY = 500; // Penalty untuk tim yang sudah main hari ini
            const GROUP_PENALTY = 30;
            const SAME_GROUP_PENALTY = 100;
            const REST_BALANCE_WEIGHT = 50; // Bobot untuk keseimbangan istirahat
            const MATCH_COUNT_WEIGHT = 100; // Bobot untuk jumlah match yang sudah dimainkan

            // Hitung waktu operasional per hari
            const operatingMinutes = end - start;

            while (matches.length > 0) {
                // Jika waktu habis, lanjut ke hari berikutnya
                if (time + dur > end) {
                    day++;
                    time = start;
                    table = createTable(day);
                    matchesPerDay[day] = 0;
                    groupMatchCountPerDay[day] = {};
                    lastGroup = null;

                    // Reset counter match hari ini
                    for (let team in matchCountToday) {
                        matchCountToday[team] = 0;
                    }
                }

                // Hitung bobot untuk semua match yang tersisa
                matches.forEach(m => {
                    // Hitung istirahat RELATIF (dalam hari ini)
                    let restA = time - lastMatchTime[m.a];
                    let restB = time - lastMatchTime[m.b];

                    // Jika tim belum main hari ini, set istirahat = operatingMinutes
                    // Ini memberi prioritas pada tim yang belum main hari ini
                    if (matchCountToday[m.a] === 0 && day > 1) {
                        restA = operatingMinutes;
                    }
                    if (matchCountToday[m.b] === 0 && day > 1) {
                        restB = operatingMinutes;
                    }

                    // HARD CONSTRAINT: tidak boleh main berturut-turut
                    if (restA < MIN_REST || restB < MIN_REST) {
                        m.weight = -Infinity;
                        return;
                    }

                    // Faktor 1: Keseimbangan istirahat
                    const minRest = Math.min(restA, restB);
                    const restDiff = Math.abs(restA - restB);
                    let balanceScore = (minRest * 2) - restDiff;

                    // Faktor 2: Prioritas untuk tim yang belum main hari ini
                    let dayPriority = 0;
                    if (matchCountToday[m.a] === 0) dayPriority += 50;
                    if (matchCountToday[m.b] === 0) dayPriority += 50;

                    // Faktor 3: Prioritas untuk tim yang total match-nya lebih sedikit
                    const totalMatchDiff = Math.abs(matchCountTotal[m.a] - matchCountTotal[m.b]);
                    const avgMatchCount = (matchCountTotal[m.a] + matchCountTotal[m.b]) / 2;
                    let matchCountScore = (5 - avgMatchCount) * MATCH_COUNT_WEIGHT - totalMatchDiff * 20;

                    // Faktor 4: Penalty untuk grup yang sama berturut-turut
                    let groupPenalty = (m.g === lastGroup) ? SAME_GROUP_PENALTY : 0;

                    // Faktor 5: Penalty untuk grup yang sudah banyak main hari ini
                    const playedToday = groupMatchCountPerDay[day][m.g] || 0;
                    let groupDayPenalty = playedToday * GROUP_PENALTY;

                    // Gabungkan semua faktor
                    m.weight =
                        balanceScore * REST_BALANCE_WEIGHT +
                        dayPriority * 10 +
                        matchCountScore -
                        groupPenalty -
                        groupDayPenalty;

                    // Bonus untuk match yang kedua timnya belum main hari ini
                    if (matchCountToday[m.a] === 0 && matchCountToday[m.b] === 0) {
                        m.weight += 200;
                    }
                });

                // Urutkan berdasarkan bobot tertinggi
                matches.sort((a, b) => b.weight - a.weight);

                // Ambil match dengan bobot tertinggi
                const m = matches.shift();

                // Update data
                lastMatchTime[m.a] = time;
                lastMatchTime[m.b] = time;
                lastGroup = m.g;

                matchCountToday[m.a]++;
                matchCountToday[m.b]++;
                matchCountTotal[m.a]++;
                matchCountTotal[m.b]++;

                groupMatchCountPerDay[day][m.g] =
                    (groupMatchCountPerDay[day][m.g] || 0) + 1;

                // Tambahkan ke jadwal
                const r = document.createElement("tr");
                r.innerHTML = `
                    <td>${minutesToTime(time)}-${minutesToTime(time + dur)}</td>
                    <td>Grup ${m.g}</td>
                    <td>${m.a} vs ${m.b}</td>
                `;
                table.querySelector("tbody").appendChild(r);

                matchesPerDay[day]++;
                time += dur;
            }

            // Hitung statistik
            const maxMatchPerDay = Math.max(...Object.values(matchesPerDay));
            const minMatchPerDay = Math.min(...Object.values(matchesPerDay));
            const matchPerGroup = (tC * (tC - 1)) / 2;
            const totalMatch = matchPerGroup * gC;
            const totalDays = Object.keys(matchesPerDay).length;

            // Hitung distribusi match per tim
            let minMatches = Infinity;
            let maxMatches = 0;
            for (let team in matchCountTotal) {
                minMatches = Math.min(minMatches, matchCountTotal[team]);
                maxMatches = Math.max(maxMatches, matchCountTotal[team]);
            }
            const matchSpread = maxMatches - minMatches;

            // Hitung distribusi istirahat
            let restTimes = [];
            for (let team in lastMatchTime) {
                if (lastMatchTime[team] > 0) {
                    restTimes.push(lastMatchTime[team] - start);
                }
            }
            const avgRest = restTimes.length > 0 ?
                Math.round(restTimes.reduce((a, b) => a + b, 0) / restTimes.length) : 0;

            statsDiv.innerHTML = `
                <div class="stat-item">
                    <div class="stat-title">Total Hari Pertandingan</div>
                    <div class="stat-value">${totalDays}</div>
                </div>

                <div class="stat-item">
                    <div class="stat-title">Match per Hari (Maks)</div>
                    <div class="stat-value">${maxMatchPerDay}</div>
                </div>

                <div class="stat-item">
                    <div class="stat-title">Match per Hari (Min)</div>
                    <div class="stat-value">${minMatchPerDay}</div>
                </div>

                <div class="stat-item">
                    <div class="stat-title">Total Match per Grup</div>
                    <div class="stat-value">${matchPerGroup}</div>
                </div>

                <div class="stat-item">
                    <div class="stat-title">Total Match Keseluruhan</div>
                    <div class="stat-value">${totalMatch}</div>
                </div>

                <div class="stat-item">
                    <div class="stat-title">Spread Match per Tim</div>
                    <div class="stat-value">${matchSpread}</div>
                </div>

                <div class="stat-item">
                    <div class="stat-title">Rata-rata Istirahat</div>
                    <div class="stat-value">${minutesToTime(avgRest)}</div>
                </div>
            `;

        }

        function createTable(day) {
            schedule.innerHTML += `<div class="day-title">Hari ke-${day}</div>`;
            const t = document.createElement("table");
            t.innerHTML = `
                <thead>
                <tr>
                    <th>Waktu</th>
                    <th>Grup</th>
                    <th>Pertandingan</th>
                </tr>
                </thead>
                <tbody></tbody>`;
            schedule.appendChild(t);
            return t;
        }
    </script>

</body>

</html>